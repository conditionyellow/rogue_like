# Rogue - The Dungeon Crawler
## ゲーム仕様書 (Game Specification)

### 📋 概要 (Overview)
**Rogue - The Dungeon Crawler** は、クラシックなRoguelikeゲームをWebブラウザ上で再現したターンベースのダンジョン探索RPGです。プレイヤーは自動生成されるダンジョンを探索し、モンスターと戦い、アイテムを収集しながらキャラクターを成長させていきます。

---

## 🎮 基本仕様 (Core Specifications)

### システム要件
- **プラットフォーム**: Webブラウザ（HTML5 Canvas対応）
- **言語**: JavaScript (ES6+)
- **依存関係**: なし（Pure JavaScript実装）
- **対応ブラウザ**: Chrome, Firefox, Safari, Edge（モダンブラウザ）
- **サウンド**: Web Audio API（プロシージャル音響生成）

### 画面解像度・表示
- **キャンバスサイズ**: 640×640ピクセル
- **タイルサイズ**: 16×16ピクセル
- **表示範囲**: 40×40タイル（カメラはプレイヤーを中心に追従）
- **UI配置**: 3カラム構成のレスポンシブレイアウト（左: ステータス/操作ガイド, 中央: ゲーム画面, 右: メッセージ/操作系）

### バイリンガル対応 (Bilingual Support)
ゲーム内のすべてのテキストは、日本語と英語の2言語に対応しています。

- **言語切り替え**:
  - UI上のボタンから、いつでも表示言語を切り替えることができます。
  - 選択された言語設定はブラウザに保存され、次回ゲーム開始時にも適用されます。
  - **更新タイミング**: HTMLで構成されたUI要素のテキストは即座に更新されますが、Canvasに描画されるゲーム画面内のテキスト（アイテム名、モンスター名など）は、プレイヤーが次に行動を起こしたタイミングで更新されます。

- **対応範囲**:
  - UI要素のテキスト
  - ゲーム内メッセージ（戦闘ログ、アイテム取得、イベントなど）
  - アイテム名、魔法名、モンスター名など

- **技術**:
  - `locales/en.json` および `locales/ja.json` にすべての翻訳テキストを格納。
  - `LocalizationManager` クラスが言語の読み込み、切り替え、テキスト取得を管理。

---

## 🗺️ ダンジョンシステム (Dungeon System)

### マップ生成アルゴリズム
1. **初期化**: 40×40のマップを全て壁（`#`）で埋める
2. **部屋生成**: 5〜9個のランダムな矩形部屋を配置
   - 部屋サイズ: 4×4 〜 7×7タイル
   - 重複チェック: 部屋同士の重複を防止
3. **通路生成**: 隣接する部屋を直線的な通路で接続
   - L字型通路（水平→垂直の順）
4. **階段配置**: 最後に生成された部屋の中央に下り階段（`%`）を配置

### タイル種類
| タイル | 記号 | 説明 | 色 |
|--------|------|------|-----|
| 壁 | `#` | 移動不可の壁 | `#4a4a4a` (ミディアムグレー) |
| 床 | `.` | 移動可能なフロア | `#2d2d2d` (ダークグレー) |
| 階段 | % | 次の階への移動ポイント | `#ecf0f1` (明るいグレー) |
| 罠 | `^` | 作動済みの罠 | 種類による |

### 罠システム (Trap System)
ダンジョンにはプレイヤーを妨害する様々な罠が隠されています。

- **特性**:
  - **不可視**: 罠は初期状態では見えません。
  - **作動**: プレイヤーがそのタイルに移動すると作動します。モンスターは罠を作動させません。
  - **可視化**: 作動した罠はその場に表示され、再作動しません。

- **配置**:
  - ダンジョン全体の床タイル（部屋および通路）に対し、一定の確率でランダムに配置されます。

- **セービングスロー (Saving Throw)**:
  - プレイヤーが罠を作動させた際、**器用さ (Dexterity)** の値に応じて自動的に「セービングスロー（回避判定）」が行われます。
  - **成功確率**: `(Dexterity * 1.5) %`
  - 判定に成功すると、罠の効果を完全に無効化できます。失敗した場合は通常通り効果を受けます。

- **種類**:
| 罠の種類 | 効果 | メッセージ |
|---|---|---|
| **ダメージトラップ** | プレイヤーが10ポイントのダメージを受ける。 | "You stepped on a Spike Trap and took 10 damage!" |
| **テレポートトラップ** | フロア内のランダムな部屋へテレポートする。 | "You stepped on a Teleport Trap! You are whisked away!" |
| **アラームトラップ** | 大きな音を立て、フロア内のモンスターにプレイヤーの存在を知らせる（特別なAI効果はなし）。 | "You stepped on an Alarm Trap! It emits a loud alarm!" |

### ショップシステム (Shop System)
ダンジョン内には、アイテムを売買できる特別な「ショップ部屋」が稀に生成されます。

- **商人 (Merchant)**:
  - **記号**: `&`
  - **役割**: 友好的なNPC。プレイヤーとアイテムの取引を行う。
  - **配置**: ショップ部屋の中央に1人だけ配置される。敵対的ではない。

- **ショップ部屋**:
  - **生成**: 2階層以降、一定の確率でダンジョン内に1つだけ生成される。
  - **安全性**: この部屋には敵や罠は生成されない。

- **取引**:
  - **開始**: 商人に隣接した状態で `B` キーを押すと、取引画面が開く。
  - **購入**: ゴールドを消費して、商人が販売するアイテム（ポーション、ランダムな性能の装備品など）を購入できる。品揃えは階層によって変化する。
  - **売却**: インベントリ内の不要なアイテムを、基本価格の40%で売却できる。装備中のアイテムは売却不可。

---

## 👤 キャラクターシステム (Character System)

### プレイヤーキャラクター
- **表示記号**: `@`
- **色**: `#7dd87d` (鮮やかな緑)
- **初期配置**: 最初に生成された部屋の中央

#### 基本ステータス
| ステータス | 初期値 | 説明 |
|------------|--------|------|
| Level | 1 | キャラクターレベル |
| HP | 100/100 | ヒットポイント（体力） |
| MP | 50/50 | マジックポイント（魔力） |
| Attack | 10 | 攻撃力 |
| Defense | 5 | 防御力 |
| Dexterity | 10 | 器用さ（罠の回避などに関わる） |
| Experience | 0 | 経験値 |
| Gold | 0 | 所持金 |

#### レベルアップシステム
- **必要経験値**: 初回100、以後1.5倍ずつ増加
- **レベルアップ効果**:
  - HP最大値: +8〜14 (ランダム)
  - MP最大値: +3〜7 (ランダム)  
  - Attack: +1〜2 (ランダム)
  - Defense: +1〜1 (ランダム)
  - Dexterity: +0〜1 (ランダム)
  - HP/MP完全回復

### 敵キャラクター

敵キャラクターの具体的なステータス、種類、特殊能力については、すべて `monsters.js` ファイル内で定義・管理されています。仕様書での個別記載は廃止し、コードを正として扱います。

#### **特徴**
- **多様なモンスター**: ダンジョンの階層が深くなるにつれて、より強力で多様なモンスターが出現します。
- **階層別ティアシステム**: モンスターは複数のティア（階級）に分かれており、浅い階層ではティア1のモンスターが、深い階層ではティア5や6の強力なモンスターが登場します。
- **動的な強化**: `createEnhancedMonster` 関数により、同じモンスターでも登場階層に応じてステータスが強化されます。
- **特殊能力**: `fly`（飛行）、`poison`（毒）、`steal`（盗む）、`regen`（再生）など、様々な特殊能力を持つモンスターが存在します。詳細は `monsters.js` を参照してください。

#### 敵AI仕様
1. **索敵**: プレイヤーとの距離を計算
2. **移動**: プレイヤーに向かって1タイルずつ移動
3. **攻撃**: プレイヤーと隣接時に自動攻撃
4. **移動制限**: 壁・他の敵・プレイヤーの位置は移動不可
5. **移動順序**: X軸・Y軸の移動をランダムに選択

---

## ⚔️ 戦闘システム (Combat System)

### 戦闘フロー
1. **戦闘開始**: プレイヤーが敵に隣接した位置に移動
2. **ダメージ計算**: `max(1, 攻撃力 - 防御力 + ランダム(-2〜+2))`
3. **HP減算**: 計算されたダメージをHPから減算
4. **死亡判定**: HP ≤ 0で死亡
5. **報酬**: 敵が死亡時、経験値・金額を獲得

### 戦闘メッセージ
- プレイヤー攻撃: `"You hit [敵名] for [ダメージ] damage!"`
- 敵攻撃: `"[敵名] hits you for [ダメージ] damage!"`  
- 敵死亡: `"[敵名] dies!"`
- プレイヤー死亡: `"You have died! Game Over."`

---

## 🎒 アイテムシステム (Item System)

### アイテム管理
- **グローバルアイテムID**: 全てのアイテムにユニークな数値IDを自動割り当て
- **重複防止システム**: アイテム拾得・装備変更時に新しいIDを生成
- **安全削除機能**: ID照合による確実なアイテム削除とエラーログ出力

### アイテム種類

ゲーム内に登場する全てのアイテム（ポーション、武器、防具、盾など）の具体的な性能は、`items.js` ファイル内で定義・管理されています。仕様書での個別記載は廃止し、コードを正として扱います。

- **アイテムタイプ**: `potion`, `weapon`, `armor`, `shield`, `gold` など、様々な種類のアイテムが存在します。
- **動的な性能**: 武器や防具の中には、ダンジョンの階層に応じて性能が強化されて出現するものもあります。
- **希少度 (Rarity)**: アイテムには希少度を示す `rarity` プロパティが設定されています。これにより、ゲームバランスが調整されます。
  - **設定値**: `uncommon` (珍しい)、 `rare` (希少) などがあります。設定がない場合は「通常 (common)」として扱われます。
  - **出現制御**: `rarity` の値に応じて、アイテムが出現し始めるダンジョン階層や、商人の品揃えが変化します。
    - **通常 (common)**: 1階から出現します。
    - **uncommon**: 5階から出現します。
    - **rare**: 10階から出現します。
- **詳細は `items.js` を参照してください。**

### アイテム使用システム

`I`キーを押すことで、テキストベースのインベントリ操作モードに入ります。

1. **アイテムリストの表示**:
   - `I`キーを押すと、所持しているアイテムが番号付きリストでメッセージ欄に表示されます。

2. **アイテムの選択**:
   - 表示されたリストの番号キー (`1`～`9`) を押して、操作したいアイテムを選択します。

3. **アクションの選択**:
   - アイテムを選択すると、そのアイテムに対して実行可能なアクション（例: `1: 使う/装備する`, `2: 捨てる`）が提示されます。
   - 対応する番号キーを押してアクションを決定します。
   - `ESC`キーでアイテム選択やアクション選択をキャンセルできます。

このシステムにより、キーボード操作のみで迅速なアイテム管理が可能です。


#### **使用制限・智能判定**
- **HP満タン時**: Health Potionの使用を自動拒否
- **MP満タン時**: Mana Potionの使用を自動拒否
- **装備重複防止**: 同じアイテムの再装備を自動検出・拒否
- **インベントリ範囲外**: 存在しないアイテム番号の指定を自動拒否

### アイテム配置
- **配置確率**: 各部屋60%の確率でアイテム1個配置
- **配置位置**: 部屋内のランダムな床タイル
- **選択**: アイテム種類はランダム選択

### 装備システム
- **装備スロット**: 武器（weapon）・防具（armor）・盾（shield）の3スロット
- **装備交換**: 新装備時に既存装備を自動でインベントリに戻す
- **ステータス計算**: 基本値＋装備ボーナスをリアルタイム計算
- **装備表示**: 装備中のアイテム情報とボーナス値を詳細表示

---

## 🪄 魔法システム (Magic System)

MP（マジックポイント）を消費して、戦闘や回復に役立つ様々な魔法を詠唱できます。

### 魔法の詠唱
1. **魔法選択モード**: `M`キーを押して魔法選択モードを開始します。
2. **魔法の選択**: メッセージ欄に表示される習得済みの魔法リストから、使用したい魔法の番号キー（`1`〜`9`）を押します。
3. **効果発動**: 選択した魔法の効果が発動します。
   - **ターゲット指定**: `Fireball`のような方向指定が必要な魔法は、選択後に方向キー（`W/A/S/D`または`↑/↓/←/→`）でターゲット方向を決定します。

### 魔法の種類
| 魔法名 | 消費MP | 効果 | ターゲット |
|------------|------|------|------|
| **Heal** | 8 | HPを25ポイント回復 | 自分自身 |
| **Fireball** | 10 | 威力15の火の玉を放つ（射程6タイル） | 方向指定 |

### 技術仕様
- **MP消費**: 魔法使用時にプレイヤーのMPがコスト分だけ減少します。MPが不足している場合は詠唱できません。
- **Projectile管理**: `Fireball`のような飛翔する魔法は、`projectiles`配列で管理され、毎ターン移動と衝突判定が行われます。

---

## 🎯 ゲームプレイ (Gameplay)

### 操作方法
| キー | 動作 | 詳細 |
|------|------|------|
| `W` / `↑` | 上移動 | 1タイル上に移動 |
| `S` / `↓` | 下移動 | 1タイル下に移動 |  
| `A` / `←` | 左移動 | 1タイル左に移動 |
| `D` / `→` | 右移動 | 1タイル右に移動 |
| `Space` | 休憩 | HP+2, MP+1回復 |
| `G` | アイテム取得 | 足元のアイテムを拾う |
| `I` | **インベントリ操作** | アイテムの使用/装備/ドロップを行う |
| `M` | **魔法選択モード** | 習得済みの魔法リストを表示し、詠唱する |
| `1`～`9` | **リスト選択** | インベントリ/魔法のリストから項目を選択 |
| `B` | **取引** | 隣接する商人とアイテムを売買する |
| `E` | **装備表示** | 現在装備中の武器、防具、盾を表示 |
| `ESC` | キャンセル | 各種選択モードを終了 |
| `R` | **ゲーム再開** | GAMEOVER画面表示時に新しいゲームを開始 |

### ターンシステム
1. **プレイヤーフェーズ**: プレイヤーが1アクション実行
2. **敵フェーズ**: 全ての生存している敵が1回ずつ行動  
3. **ターン終了**: ターン数を1増加し、次のプレイヤーフェーズへ

### 階層進行システム
- **階層表示**: UI右上に現在の階層（Floor）番号を表示
- **階段発見**: ダンジョン最深部の部屋中央に下り階段（`%`記号）を配置
- **深層進行**: 階段上で自動的に次の階層へ移動
- **完全再生成**: 新階層では敵・アイテム・マップを完全にリセット
- **プレイヤー配置**: 新階層では最初の部屋の中央からスタート

### 勝利条件・敗北条件
- **勝利条件**: なし（無限プレイ・階層制限なし）
- **敗北条件**: プレイヤーのHP ≤ 0
- **継続条件**: 階段（`>`）で次の階層へ移動可能

### GAMEOVER画面システム（新機能）
本ゲームはクラシックなRogue（rogue5.4.4-ant-r1.1.2）の伝統的な死亡画面を現代的にアレンジしたGAMEOVER画面を実装しています。

#### **表示内容**
- **ASCII墓石アート**: オリジナルRogueから継承された伝統的なASCII墓石デザイン
- **死亡原因**: プレイヤーを倒したモンスター名を表示（"Killed by a goblin"形式）
- **最終スコア**: ゲームプレイの総合評価点数
- **詳細統計情報**:
  - **Level**: 達成レベル
  - **Floor**: 到達階層
  - **Turns**: 総プレイターン数
  - **Gold**: 所持金額
  - **Experience**: 獲得経験値
  - **Monsters defeated**: 倒したモンスター数
  - **Items found**: 発見したアイテム数
- **装備情報**: 死亡時に装備していた武器・防具

#### **スコア計算システム**
'''javascript
最終スコア = (Gold × 5) + (Experience × 2) + (Level × 100) + 
            (Floor × 50) - (Turns × 0.1) + 装備ボーナス

装備ボーナス = (武器攻撃力 × 20) + (防具防御力 × 15)
'''

#### **レスポンシブデザイン**
- **大画面対応**: 標準サイズ（画面高700px以上）での最適表示
- **小画面対応**: 自動判定（画面高700px未満）でのコンパクト表示
  - フォントサイズの動的調整
  - パディングの最適化
  - スクロール機能の自動有効化
- **モバイル対応**: タッチデバイスでの操作性最適化

#### **インタラクション**
- **キーボード操作**:
  - `R`: ゲーム再開（新しいゲームで最初から）
  - `ESC`: GAMEOVER画面を閉じる
- **マウス/タッチ操作**: 各ボタンのクリック/タップ対応
- **表示タイミング**: プレイヤー死亡から1秒後に自動表示

#### **技術仕様**
- **モーダルオーバーレイ**: 半透明背景による没入的表示
- **動的コンテンツ生成**: JavaScript DOM操作による柔軟な画面構築
- **イベントハンドリング**: キーボード・マウス両対応の統合操作システム
- **メモリ管理**: 画面クローズ時の完全なクリーンアップ処理

---

## 🎨 デザイン・UI仕様 (Design & UI Specifications)

### カラーパレット
本ゲームは目に優しく現代的なダークモード配色を採用し、長時間のプレイに適した洗練されたデザインを実現しています。

#### ゲーム要素の色
| 要素 | 色 | RGB | 備考 |
|------|----|----|------|
| 背景（床） | `#1a1a1a` | (26, 26, 26) | ダークグレーの落ち着いた背景 |
| 壁・障害物 | `#4a4a4a` | (74, 74, 74) | 中間グレーで視認性を確保 |
| 床タイル | `#2d2d2d` | (45, 45, 45) | 背景より僅かに明るい床面 |
| プレイヤー | `#7dd87d` | (125, 216, 125) | 鮮やかな緑で主人公を強調 |
| 敵 | `#e74c3c` | (231, 76, 60) | 温かい赤で危険性を表現 |
| アイテム（一般） | `#f39c12` | (243, 156, 18) | 温かいオレンジで発見しやすく |
| ポーション | `#9b59b6` | (155, 89, 182) | 神秘的な紫色 |
| 武器 | `#e67e22` | (230, 126, 34) | 力強いオレンジ |
| 防具 | `#3498db` | (52, 152, 219) | 信頼できる青色 |
| 金貨 | `#f1c40f` | (241, 196, 15) | 輝く金色 |
| 階段 | `#ecf0f1` | (236, 240, 241) | 明るいグレーで目標を明示 |

#### UI要素の色
| 要素 | 色 | RGB | 備考 |
|------|----|----|------|
| UI背景 | `#2c3e50` | (44, 62, 80) | 深いブルーグレーで情報パネル |
| UI枠線 | `#34495e` | (52, 73, 94) | コントラストを保つ枠線 |
| メインテキスト | `#ecf0f1` | (236, 240, 241) | 明るく読みやすいテキスト |
| セカンダリテキスト | `#bdc3c7` | (189, 195, 199) | 補助情報用の控えめなテキスト |
| 戦闘メッセージ | `#e74c3c` | (231, 76, 60) | 戦闘ログは赤で緊迫感を演出 |
| アイテムメッセージ | `#f39c12` | (243, 156, 18) | アイテム関連は暖色で親しみやすく |
| システムメッセージ | `#95a5a6` | (149, 165, 166) | システム情報は落ち着いたグレー |
| ヘルスバー | `#e74c3c` | (231, 76, 60) | 体力は重要な赤色 |
| マナバー | `#3498db` | (52, 152, 219) | 魔力は神秘的な青色 |

### メッセージエリア
- **背景色**: `#34495e` (深いグレーブルー)
- **枠線**: `#7f8c8d` (ミディアムグレー)
- **パディング**: 8px
- **フォントサイズ**: 11px
- **行間**: 1.3

### オーディオコントロール
- **背景色**: `#34495e` (統一されたUI背景)
- **枠線**: `#7f8c8d` (統一された枠線色)
- **ボタン背景**: `#2c3e50` (主要UIカラー)
- **ボタンテキスト**: `#ecf0f1` (読みやすいライトテキスト)
- **ホバー効果**: `#34495e` (インタラクションフィードバック)

### カラーデザイン哲学
1. **目の疲労軽減**: 高コントラストながら眩しすぎない配色
2. **情報階層**: 重要度に応じた色の明度・彩度調整
3. **一貫性**: UI全体で統一されたカラーテーマ
4. **アクセシビリティ**: 色覚多様性に配慮した色選択
5. **ゲーム性**: クラシックRogueの雰囲気を保ちつつ現代的な洗練

### レイアウト設計
- **レスポンシブ対応**: 3カラムレイアウトを採用。ワイドスクリーンでは「ステータス/操作ガイド」「ゲーム画面」「メッセージ/操作系」を左右に配置。画面幅が狭い場合は、自動的に縦積みのレイアウトに切り替わり、常に情報がスクロールなしで表示されるように最適化されます。
- **センタリング**: ゲーム画面を常に中央に配置。
- **等幅フォント**: `Courier New` でレトロゲーム感を演出。

### 操作ガイド (Control Guide)
画面左下のパネルに、ゲームの主要な操作方法が常に表示されるようになりました。
初めてプレイする方でも迷うことなくゲームを楽しめるよう、移動、アイテム、魔法、ショップ、ゲーム操作に関する情報が整理されています。

---

## 💻 技術仕様 (Technical Specifications)

### クラス構造

#### `AudioManager`クラス（サウンドシステム）
'''javascript
class AudioManager {
    // ... (内容は変更なし)
}
'''

#### `Game`クラス（メインゲームエンジン）
'''javascript
class Game {
    // コンストラクタ・初期化
    constructor()
    init()
    setupEventListeners()
    
    // ゲームループ・入力処理
    handleInput(e)
    handleItemSelection(e)
    handleMagicSelection(e)   // 新機能: 魔法選択モード
    processTurn()
    
    // プレイヤー制御
    movePlayer(dx, dy)
    pickupItem()
    useItem()
    
    // 新アイテムシステム
    startItemSelection()
    useItemByIndex(index)
    removeItemFromInventory(itemId)
    
    // 魔法システム (新機能)
    startMagicSelection()
    castSpell(spellId, options)
    getDirectionFromKey(key)
    updateProjectiles()
    renderProjectiles(cameraX, cameraY)

    // 装備システム
    equipItem(item)
    unequipItem(slot)
    showEquipment()
    removeEquipment()
    updatePlayerStats()
    
    // 戦闘・レベリング
    combat(attacker, defender)
    checkLevelUp()
    
    // GAMEOVER・ゲーム状態管理
    gameOver(killer)
    showGameOverScreen(killer)
    calculateFinalScore()
    getGameStats()
    restart()
    
    // ダンジョン・階層管理
    generateDungeon()
    descendStairs()
    carveRoom(room)
    connectRooms(room1, room2)
    
    // エンティティ管理
    createPlayer()
    spawnEnemies()
    spawnItems()
    spawnTraps() // New
    
    // 罠システム
    getTrapAt(x, y) // New
    triggerTrap(trap) // New

    // レンダリング・UI
    render()
    renderTile(x, y, tile)
    renderEntity(x, y, symbol, color)
    updateUI()
    addMessage(text, type)
    updateMessages()
    
    // インベントリUIシステム
    showInventoryUI()
    hideInventoryUI()
    createInventoryUI()
    createInventoryItemElement()
    updateInventoryUI()
    removeInventoryUI()
    handleInventoryInput()
    dropItem()

    // ショップシステム
    interactWithMerchant()
    generateShopInventory()
    showShopUI()
    hideShopUI()
    createShopUI()
    createShopItemElement()
    handleShopInput()
    buyItem()
    sellItem()
    
    // ユーティリティ
    random(min, max)
}
'''

#### `LocalizationManager`クラス（バイリンガル対応システム）
'''javascript
class LocalizationManager {
    constructor()
    init()
    loadLanguage(lang)
    setLanguage(lang)
    t(key, replacements)
    updateUI()
}
'''

### データ構造

#### ゲームステート
'''javascript
game = {
    // ... (既存のプロパティ)
    gameState: string,            // ゲーム状態 ('playing', 'dead', 'gameover', 'targeting')
    itemSelectionMode: boolean,   // アイテム選択モード中フラグ
    magicSelectionMode: boolean,  // 魔法選択モード中フラグ (新機能)
    inventoryUIActive: boolean,   // インベントリUI表示フラグ
    shopUIActive: boolean,        // ショップUI表示フラグ (新機能)
    // ... (既存のプロパティ)
    projectiles: Array,           // 飛翔する魔法の弾などを管理 (新機能)
    traps: Array,                 // ダンジョン内の罠を管理 (新機能)
    spells: Object,               // ゲーム内の全魔法の定義 (新機能)
    // ... (既存のプロパティ)
}
'''

#### プレイヤーオブジェクト
'''javascript
player = {
    // ... (既存のプロパティ)
    gold: number,        // 所持金
    inventory: Array,    // アイテム配列
    spells: Array,       // 習得済みの魔法ID配列 (新機能)
    equipment: {         // 装備スロット
        weapon: Object,  // 装備中の武器
        armor: Object,   // 装備中の防具
        shield: Object   // 装備中の盾
    },
    // ... (既存のプロパティ)
}
'''

#### 敵オブジェクト
'''javascript
enemy = {
    // ... (内容は変更なし)
}
'''

#### アイテムオブジェクト
'''javascript
item = {
    // ... (内容は変更なし)
}
'''

---

## 🔧 拡張予定機能 (Future Enhancements)

### 優先度: 高
- [x] **装備システム**: 武器・防具の実装 ✅
- [x] **アイテム選択システム**: インタラクティブなアイテム使用 ✅
- [x] **階層進行システム**: フロア移動と表示 ✅
- [x] **アイテムID管理**: 重複防止とデバッグ強化 ✅
- [x] **インベントリUI**: 専用インベントリ画面 ✅
- [x] **レイアウト最適化**: ダンジョン表示領域とステータス領域の高さ統一 ✅
- [x] **サウンドシステム**: プロシージャル効果音・BGMの追加 ✅
- [x] **GAMEOVER画面**: クラシックRogue風の死亡画面・スコアシステム ✅
- [x] **ダークモードテーマ**: 目に優しい現代的なダークテーマ実装 ✅
- [x] **レイアウト改善**: 3カラムレスポンシブレイアウトの実装 ✅
- [x] **魔法システム**: 基本的な魔法（Fireball, Heal）の実装 ✅
- [x] **バイリンガル対応**: 日本語と英語の切り替え機能 ✅
- [x] **セーブ/ロード**: ローカルストレージによるゲーム保存 ✅

### 優先度: 中
- [x] **罠システム**: ダンジョン内の仕掛け ✅
- [x] **ショップ**: 金額でアイテム購入 ✅
- [ ] **ボスモンスター**: 強力な敵キャラクター

### 優先度: 低  
- [ ] **視界システム**: Fog of War（霧戦争）
- [ ] **地形バリエーション**: 水・溶岩・氷などの特殊地形
- [ ] **クエストシステム**: 目標・報酬システム
- [ ] **マルチプレイ**: オンライン協力プレイ

---

## 🐛 既知の問題・制限事項 (Known Issues & Limitations)

(このセクションは変更なし)

---

## 📊 バランス調整データ (Balance Data)

(このセクションは変更なし)

---

## 📝 更新履歴 (Change Log)

### Version 1.13.0 (2025-10-26) - 📖 **操作ガイドUI実装**
- ✅ **画面左下のUI変更**
  - 従来の常時表示インベントリを廃止し、操作方法を解説する「操作ガイド」パネルを配置。
  - 初めてのプレイヤーでも迷わないよう、移動、アイテム、魔法、ショップ、ゲーム操作に関する情報を整理して表示。

### Version 1.12.0 (2025-10-26) - 🌐 **バイリンガル対応実装**
- ✅ **ゲーム全体の多言語化**
  - **言語ファイル**: `locales/en.json`と`locales/ja.json`にすべてのテキストを外部化。
  - **言語切り替え**: UI上のボタンから日本語と英語を切り替え可能。設定は保存される。
  - **LocalizationManager**: 言語管理クラスを導入し、テキストの取得とUI更新を制御。

### Version 1.11.0 (2025-10-26) - 🏃 **罠回避システム実装**
- ✅ **セービングスロー機能の追加**
  - **新ステータス「Dexterity」**: プレイヤーに「器用さ」のステータスを追加。レベルアップで成長する。
  - **罠の自動回避**: 罠作動時、Dexterityの値に基づいて確率で効果を無効化するセービングスローが自動で行われる。

### Version 1.10.0 (2025-10-26) - 🏪 **ショップシステム実装**
- ✅ **基本ショップ機能の実装**
  - **ショップ部屋**: ダンジョン内に低確率で安全な「ショップ部屋」が生成される。
  - **商人NPC**: アイテムを売買してくれる商人(`&`)を配置。
  - **売買UI**: `B`キーで開く専用UIでアイテムの購入・売却が可能。
  - **動的品揃え**: 階層に応じて品揃えが強化される。

### Version 1.9.0 (2025-10-26) - ⚠️ **罠システム実装**
- ✅ **基本罠システム実装**
  - **罠の種類**: ダメージ、テレポート、アラームの3種類を実装。
  - **配置**: ダンジョン生成時にフロア全体にランダムで配置。
  - **作動**: プレイヤーが踏むと作動し、効果を発揮。作動後は可視化される。
  - **技術実装**: `spawnTraps`, `triggerTrap` などのコアロジックを追加。

### Version 1.8.0 (2025-10-25) - 🪄 **魔法システム実装**
- ✅ **基本魔法システム実装**
  - **魔法選択**: `M`キーによる魔法選択モード
  - **MP消費**: 魔法使用時にMPを消費
  - **魔法の種類**:
    - **Heal**: 自身のHPを回復する自己詠唱魔法
    - **Fireball**: 指定方向に飛翔し、敵にダメージを与える攻撃魔法
  - **ターゲット指定**: 攻撃魔法の方向指定機能
  - **技術実装**: `castSpell`, `projectiles`管理などのコアロジックを追加

### Version 1.7.0 (2025-10-25) - 🎨 **UIレイアウト改善**
- ✅ **3カラムレスポンシブレイアウト実装**
  - **パネル分割**: 従来の単一情報パネルを「ステータス」「インベントリ」「メッセージ」「操作系」に分割
  - **レスポンシブ対応**: ワイドスクリーンでは3カラム、画面幅が狭い場合は縦積みに自動でレイアウトを変更
  - **スクロール不要**: 情報を分割配置することで、UIのスクロールを不要にし、一覧性を向上

### Version 1.6.0 (2025-06-05) - 🌙 **ダークモードテーマ実装**
- ✅ **完全ダークモードビジュアルシステム実装**
  - **包括的カラーパレット**: 15種類以上の専用ダークモード配色を設計・実装
  - **UI要素完全刷新**: 情報パネル、メッセージエリア、ボタン等をダークテーマに統一
  - **メッセージカラーリング**: 戦闘、アイテム、システムメッセージを色分け
  - **アクセシビリティ**: 長時間プレイに適した目に優しい配色

(以前の更新履歴は省略)

---

*この仕様書は開発の進行に合わせて随時更新されます。*